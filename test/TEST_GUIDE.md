# 测试指南

本指南将帮助您测试时间开销记录仪应用的各个功能。

## 前置条件

1. **安装依赖**
   ```bash
   npm run install-all
   ```

2. **配置环境变量**
   - 确保已创建 `.env` 文件
   - 检查 MongoDB 连接字符串是否正确

3. **启动 MongoDB**
   - 确保 MongoDB 服务正在运行
   - 默认连接: `mongodb://localhost:27017/time-tracker`

## 测试步骤

### 1. 依赖检查测试

运行依赖检查脚本，确保所有必要的文件和依赖都已就绪：

```bash
npm run test:check
```

### 2. 后端 API 测试

在启动服务器后，运行 API 测试：

```bash
# 首先启动服务器（新终端窗口）
npm run server

# 然后运行 API 测试（另一个终端窗口）
npm run test:api
```

### 3. 手动功能测试

#### 3.1 启动应用

```bash
# 启动开发服务器（同时启动前后端）
npm run dev
```

访问 http://localhost:3000

#### 3.2 用户认证测试

1. **注册新用户**
   - 点击"还没有账户？点击注册"
   - 输入用户名（3-20字符）和密码（至少6字符）
   - 点击"注册"
   - 应该自动登录并跳转到数据看板

2. **登录测试**
   - 退出登录
   - 使用已注册的用户名和密码登录
   - 应该成功登录

#### 3.3 分类管理测试

1. **查看默认分类**
   - 导航到"分类管理"页面
   - 应该看到5个默认分类：工作、学习、娱乐、休息、拖延

2. **创建新分类**
   - 点击"添加分类"按钮
   - 输入分类名称（如"运动"）
   - 选择类型（正/负/平）
   - 选择颜色
   - 点击"确定"
   - 应该看到新分类出现在列表中

3. **编辑分类**
   - 点击分类的编辑图标
   - 修改名称、类型或颜色
   - 点击"确定"
   - 应该看到更新后的分类

4. **删除分类**
   - 点击非默认分类的删除图标
   - 确认删除
   - 分类应该从列表中移除

#### 3.4 时间记录测试

1. **查看时间轴**
   - 导航到"时间轴"页面
   - 应该看到以30分钟为间隔的时间块网格

2. **创建时间记录**
   - 点击一个空白的时间块
   - 在弹出的对话框中：
     - 选择活动分类
     - 设置持续时间（默认30分钟）
     - 可选：添加备注
   - 点击"确定"
   - 时间块应该被填充，显示分类名称和颜色

3. **查看记录详情**
   - 已记录的时间块应该显示：
     - 分类名称
     - 持续时间
     - 备注（如果有）

4. **删除时间记录**
   - 点击已记录时间块的删除图标
   - 确认删除
   - 时间块应该恢复为空白

5. **切换日期**
   - 使用"前一天"和"后一天"按钮切换日期
   - 应该看到不同日期的记录

#### 3.5 数据看板测试

1. **查看日报**
   - 导航到"数据看板"页面
   - 默认显示日报
   - 应该看到：
     - 统计摘要（总时间、有效时间占比、记录条数）
     - 时间分配饼图
     - 时间趋势折线图

2. **切换报表类型**
   - 点击"周报"标签
   - 应该看到本周的数据统计
   - 点击"月报"标签
   - 应该看到本月的数据统计

3. **验证数据准确性**
   - 检查饼图数据是否与时间记录一致
   - 检查趋势图是否显示正确的日期范围

## 测试检查清单

- [ ] 依赖检查通过
- [ ] 服务器可以启动
- [ ] 前端可以启动
- [ ] 用户注册功能正常
- [ ] 用户登录功能正常
- [ ] 分类列表可以加载
- [ ] 可以创建新分类
- [ ] 可以编辑分类
- [ ] 可以删除分类
- [ ] 时间轴可以显示
- [ ] 可以创建时间记录
- [ ] 可以删除时间记录
- [ ] 可以切换日期查看不同记录
- [ ] 数据看板可以显示
- [ ] 报表切换功能正常
- [ ] 图表数据准确

## 常见问题

### MongoDB 连接失败

**问题**: 服务器启动时提示 MongoDB 连接失败

**解决方案**:
1. 确保 MongoDB 服务正在运行
2. 检查 `.env` 文件中的 `MONGODB_URI` 是否正确
3. 检查防火墙设置

### 端口被占用

**问题**: 提示端口 5000 或 3000 已被占用

**解决方案**:
1. 关闭占用端口的其他应用
2. 或修改 `.env` 文件中的 `PORT` 值

### CORS 错误

**问题**: 前端请求后端时出现 CORS 错误

**解决方案**:
1. 检查 `.env` 文件中的 `CLIENT_URL` 是否正确
2. 确保后端服务器正在运行

### 认证失败

**问题**: 登录后仍然提示未授权

**解决方案**:
1. 检查浏览器控制台是否有错误
2. 检查 localStorage 中是否有 token
3. 检查后端 JWT_SECRET 是否正确配置

## 性能测试

### 大量数据测试

1. 创建多个时间记录（100+ 条）
2. 检查时间轴渲染性能
3. 检查报表生成速度
4. 检查页面加载时间

### 响应式测试

1. 在不同设备上测试（桌面、平板、手机）
2. 调整浏览器窗口大小
3. 检查布局是否正常

## 安全测试

1. **未授权访问**
   - 尝试直接访问受保护的路由
   - 应该重定向到登录页面

2. **输入验证**
   - 尝试输入无效数据（如空字符串、超长字符串）
   - 应该显示错误提示

3. **XSS 防护**
   - 在输入框中输入脚本标签
   - 应该被正确转义

## 自动化测试

运行自动化 API 测试：

```bash
npm run test:api
```

这将测试所有主要的 API 端点，包括：
- 用户注册和登录
- 分类管理
- 时间记录 CRUD
- 报表生成

